<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>线路派送</title>
	<link rel="stylesheet" href="../css/form/style.css" />
	<link rel="stylesheet" href="../css/form/home.css" />
    <link href="../js/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="../js/bootstrap-select-1.12.4/dist/css/bootstrap-select.min.css" rel="stylesheet" />

    <script src='../js/jquery/jquery-1.10.2.min.js' ></script>
    <script src="../js/bootstrap/js/bootstrap.min.js"></script>
    <script src="../js/bootstrap-select-1.12.4/dist/js/bootstrap-select.min.js"></script>
    <script src="../js/bootstrap/js/typeahead-bs2.min.js"></script>
	<script src="../js/base.js" type="text/javascript" ></script>
</head>
<body>
<div class="container" style="width: 1000px" id="box">
        <input type="hidden" id="score"/>
        <input type="hidden" id="joinPoints"/>
        <input type="hidden" id="dis"/>
        <div class="cancel"></div>
        <div class="show"></div>
        <ul class="point_list">
            <li class="point1"></li>
            <li class="point2"><a href="javascript:void(0);">青年路35号创业大厦5楼506室</a>
            </li>
            <li class="point3"></li>
            <li class="point4"><a href="javascript:void(0);">黄河路55号大美制衣办公楼2楼209室</a>
            </li>
            <li class="point5"></li>
            <li class="point6"></li>
            <li class="point7"></li>
            <li class="point8"></li>
            <li class="point9"></li>
            <li class="point10"></li>
            <li class="point11"></li>
            <li class="point12"></li>
            <li class="point13"></li>
            <li class="point14"></li>
            <li class="point15"></li>
            <li class="point16"></li>
            <li class="point17"><a href="javascript:void(0);">青年路35号创业大厦11楼1110室</a>
            </li>
            <li class="point18"><a href="javascript:void(0);">青年路35号创业大厦15楼1511室</a>
            </li>
            <li class="point19"><a href="javascript:void(0);">青年路35号创业大厦17楼1703室</a>
            </li>
            <li class="point20"><a href="javascript:void(0);">黄河路55号大美制衣办公楼3楼318室</a>
            </li>
            <li class="point21"><a href="javascript:void(0);">黄河路55号大美制衣办公楼4楼405室</a>
            </li>
        </ul>
        <canvas width="1000px" height="680px" id="line"></canvas>
    </div>
    <div class="modal fade" id="resultAlert">  
        <div class="modal-dialog" style="width: 95%;height: 90%;">  
            <div class="modal-content" style="height: 100%; overflow-y: scroll; ">  
                <div class="modal-header">  
                    <button id="modalClose" type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">派送详情</h4>  
                </div>  
                <div class="modal-body"> 
				    <div id="main" class="main">
				        <div class="boxBg  boxBgPage">
				            <table cellspacing="0" cellpadding="0">
				                <thead>
				                    <tr>
				                        <th colspan="3">派送路单</th>
				                    </tr>
				                </thead>
				                <tbody>
				                    <tr>
				                        <td class="h2">顺序</td>
				                        <td class="h2">派送地址</td>
				                        <td class="h2">备注</td>
				                    </tr>
				                    <tr>
				                        <td>1</td>
				                        <td class="point"></td>
				                        <td></td>
				                    </tr>
				                    <tr>
				                        <td>2</td>
				                        <td class="point"></td>
				                        <td></td>
				                    </tr>
				                    <tr>
				                        <td>3</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>4</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>5</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>6</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>7</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>8</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>9</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>10</td>
				                        <td class="point"></td>
				                        <td></td>
				                    </tr>
				                    <tr>
				                        <td>11</td>
				                        <td class="point"></td>
				                        <td></td>
				                    </tr>
				                    <tr>
				                        <td>12</td>
				                        <td class="point"></td>
				                        <td></td>
				                    </tr>
				                    <tr>
				                        <td>13</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>14</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>15</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>16</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>17</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>18</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>19</td>
				                        <td class="point"></td>
				                        <td></td>
				                        
				                    </tr>
				                    <tr>
				                        <td>20</td>
				                        <td class="point"></td>
				                        <td></td>
				                    </tr>
				                    
				                </tbody>
				                <tfoot>
				                    <tr>
				                        <td colspan="3">
				                            <span style="display:block;float:left">提交时间: <span id="time"></span></span>
				                            <span style="display:block;float:right">派送总路长：<span id="long"></span>KM</span>
				                        </td>
				                    </tr>
				
				                </tfoot>
				            </table>
				            <div class="divBtn disDetail">
				                <a href="javascript:void(0)" onclick="openprinl()"><i></i><span id="print" color="#FFF">提交</span></a>
				                <a style="background: url(../images/form/close_1.png) center no-repeat" href="javascript:void(0)" onclick="backGo()" >
				                    <i style="background: url(../images/form/close_02.png) center no-repeat"></i>
				                    <span id="back">重新配线</span>
				                </a>
				            </div>
				        </div>
				    </div>
				    <script type="text/javascript">
					    function openprinl(){
					           if ($("#score").val() != 22) {
					               $("#resultSpan").html("派送线路不是最优，请调整线路");
					               $("#resultModal").modal("toggle");
					           } else {
					           		// $('#modalClose').remove();//隐藏关闭按钮
					           		/*var htmls = "<div align='center' class='modal-footer'>"+ 
											"<button type='button' onclick='gameOver()' class='btn btn-primary'>确定</button>"+
											"</div>";
									
									$("#resultSpan").html("任务完成！");
									$("#nextBtn").html(htmls);

					               $("#resultModal").modal("toggle");*/
					               gameOver();
					           }
					       }
					       
					       function backGo(){
					           window.location.href="delivery.html";
					       }
					       
					</script>
                </div>  
            </div><!-- /.modal-content -->  
        </div><!-- /.modal-dialog -->  
    </div><!-- /.modal --> 
    <div class="modal fade" style="" id="resultModal">  
            <div class="modal-dialog">  
                <div class="modal-content">  
                    <div class="modal-header">  
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">提示</h4>  
                    </div>  
                    <div class="modal-body"> 
                        <span id="resultSpan"></span>
                    </div>  
                    <div align="center" class="modal-body" id="nextBtn"> 
                	</div>  
                </div><!-- /.modal-content -->  
            </div><!-- /.modal-dialog -->  
        </div><!-- /.modal --> 
</body>
<script type="text/javascript">
$(document).ready(function(){
	var dataX = [
	             [
	                 [255, 345, 345], [255, 880, 880, 635, 635], [255, 475, 475, 823, 823, 813], [255, 475, 475, 823, 823, 808], [255, 475, 475, 685, 685], [255, 475, 475, 595, 595], [255, 475, 475, 347, 347], [255, 475, 475, 270, 270], [255, 475, 475, 125, 125, 100], [255, 475, 475, 125, 125, 100], [255, 475, 475, 125, 125, 100], [255, 475, 475, 125, 125, 100], [255, 475, 475, 490], [255, 475, 475, 490], [255, 475, 475, 490], []
	             ],
	             [
	                 [], [365, 877, 877, 635, 635], [365, 472, 472, 826, 826, 813], [365, 472, 472, 826, 826, 808], [365, 472, 472, 685, 685], [365, 472, 472, 595, 595], [365, 472, 472, 347, 347], [365, 472, 472, 270, 270], [365, 472, 472, 128, 128, 100], [365, 472, 472, 128, 128, 100], [365, 472, 472, 128, 128, 100], [365, 472, 472, 128, 128, 100], [365, 472, 472, 490], [365, 472, 472, 490], [365, 472, 472, 490], [365, 472, 472, 128, 128, 245, 245]
	             ],
	             [
	                 [620, 131, 131, 345, 345], [], [620, 469, 469, 829, 829, 813], [620, 469, 469, 829, 829, 808], [620, 469, 469, 685, 685], [620, 469, 469, 595, 595], [620, 469, 469, 347, 347], [620, 469, 469, 270, 270], [620, 469, 469, 131, 131, 100], [620, 469, 469, 131, 131, 100], [620, 469, 469, 131, 131, 100], [620, 469, 469, 131, 131, 100], [620, 469, 469, 490], [620, 469, 469, 490, ], [620, 469, 469, 490], [620, 131, 131, 245, 245]
	             ], [
	                 [832, 832, 134, 134, 345, 345], [832, 832, 635, 635], [], [832, 832, 873, 873, 832, 832, 808], [832, 832, 466, 466, 685, 685], [832, 832, 466, 466, 595, 595], [832, 832, 466, 466, 347, 347], [832, 832, 466, 466, 270, 270], [832, 832, 466, 466, 134, 134, 100], [832, 832, 466, 466, 134, 134, 100], [832, 832, 466, 466, 134, 134, 100], [832, 832, 466, 466, 134, 134, 100], [832, 832, 466, 466, 490], [832, 832, 466, 466, 490], [832, 832, 466, 466, 490], [832, 832, 134, 134, 245, 245]
	             ],
	             [
	                 [835, 835, 137, 137, 345, 345], [835, 835, 635, 635], [835, 835, 813], [], [835, 835, 463, 463, 685, 685], [835, 835, 463, 463, 595, 595], [835, 835, 463, 463, 347, 347], [835, 835, 463, 463, 270, 270], [835, 835, 463, 463, 137, 137, 100], [835, 835, 463, 463, 137, 137, 100], [835, 835, 463, 463, 137, 137, 100], [835, 835, 463, 463, 137, 137, 100], [835, 835, 463, 463, 490], [835, 835, 463, 463, 490], [835, 835, 463, 463, 490], [835, 835, 137, 137, 245, 245]
	             ],
	             [
	                 [700, 870, 870, 140, 140, 345, 345], [700, 838, 838, 635, 635], [700, 838, 838, 813], [700, 838, 838, 808], [], [700, 870, 870, 425, 425, 595, 595], [700, 870, 870, 347, 347], [700, 870, 870, 270, 270], [700, 870, 870, 140, 140, 100], [700, 870, 870, 140, 140, 100], [700, 870, 870, 140, 140, 100], [700, 870, 870, 140, 140, 100], [700, 838, 838, 460, 460, 490], [700, 838, 838, 460, 460, 490], [700, 838, 838, 460, 460, 490], [700, 870, 870, 140, 140, 245, 245]
	             ],
	             [
	                 [610, 867, 867, 143, 143, 345, 345], [610, 841, 841, 635, 635], [610, 841, 841, 813], [610, 841, 841, 808], [610, 685, 685], [], [610, 867, 867, 347, 347], [610, 867, 867, 270, 270], [610, 867, 867, 143, 143, 100], [610, 867, 867, 143, 143, 100], [610, 867, 867, 143, 143, 100], [610, 867, 867, 143, 143, 100], [610, 841, 841, 457, 457, 490], [610, 841, 841, 457, 457, 490], [610, 841, 841, 457, 457, 490], [610, 867, 867, 143, 143, 245, 245]
	             ],
	             [
	                 [332, 146, 146, 345, 345], [332, 146, 146, 844, 844, 635, 635], [332, 146, 146, 844, 844, 813], [332, 146, 146, 844, 844, 808], [332, 146, 146, 685, 685], [332, 146, 146, 595, 595], [], [332, 270, 270], [332, 146, 146, 100], [332, 146, 146, 100], [332, 146, 146, 100], [332, 146, 146, 100], [332, 146, 146, 454, 454, 490], [332, 146, 146, 454, 454, 490], [332, 146, 146, 454, 454, 490], [332, 146, 146, 245, 245]
	             ],
	             [
	                 [255, 143, 143, 345, 345], [255, 143, 143, 841, 841, 635, 635], [255, 143, 143, 841, 841, 813], [255, 143, 143, 841, 841, 808], [255, 143, 143, 685, 685], [255, 143, 143, 595, 595], [255, 143, 143, 457, 457, 347, 347], [], [255, 143, 143, 100], [255, 143, 143, 100], [255, 143, 143, 100], [255, 143, 143, 100], [255, 143, 143, 457, 457, 490], [255, 143, 143, 457, 457, 490], [255, 143, 143, 457, 457, 490], [255, 143, 143, 245, 245]
	             ],
	             [
	                 [140, 140, 345, 345], [140, 140, 870, 870, 635, 635], [140, 140, 870, 870, 838, 838, 813], [140, 140, 870, 870, 838, 838, 808], [140, 140, 460, 460, 685, 685], [140, 140, 460, 460, 595, 595], [140, 140, 460, 460, 347, 347], [140, 140, 460, 460, 270, 270], [], [140, 140, 100], [140, 140, 100], [140, 140, 100], [140, 140, 460, 460, 490], [140, 140, 460, 460, 490], [140, 140, 460, 460, 490], [140, 140, 245, 245]
	             ],
	             [
	                 [137, 137, 345, 345], [137, 137, 873, 873, 635, 635], [137, 137, 873, 873, 835, 835, 813], [137, 137, 873, 873, 835, 835, 808], [137, 137, 463, 463, 685, 685], [137, 137, 463, 463, 595, 595], [137, 137, 463, 463, 347, 347], [137, 137, 463, 463, 270, 270], [137, 137, 162, 162, 137, 137, 100], [], [137, 137, 100], [137, 137, 100], [137, 137, 463, 463, 490], [137, 137, 463, 463, 490], [137, 137, 463, 463, 490], [137, 137, 245, 245]
	             ],
	             [
	                 [134, 134, 345, 345], [134, 134, 876, 876, 635, 635], [134, 134, 876, 876, 832, 832, 813], [134, 134, 876, 876, 832, 832, 808], [134, 134, 466, 466, 685, 685], [134, 134, 466, 466, 595, 595], [134, 134, 466, 466, 347, 347], [134, 134, 466, 466, 270, 270], [134, 134, 165, 165, 134, 134, 100], [134, 134, 165, 165, 134, 134, 100], [], [134, 134, 100], [134, 134, 466, 466, 490], [134, 134, 466, 466, 490], [134, 134, 466, 466, 490], [134, 134, 245, 245]
	             ],
	             [
	                 [131, 131, 345, 345], [131, 131, 879, 879, 635, 635], [131, 131, 879, 879, 829, 829, 813], [131, 131, 879, 879, 829, 829, 808], [131, 131, 469, 469, 685, 685], [131, 131, 469, 469, 595, 595], [131, 131, 469, 469, 347, 347], [131, 131, 469, 469, 270, 270], [131, 131, 168, 168, 131, 131, 100], [131, 131, 168, 168, 131, 131, 100], [131, 131, 168, 168, 131, 131, 100], [], [131, 131, 469, 469, 490], [131, 131, 469, 469, 490], [131, 131, 469, 469, 490], [131, 131, 245, 245]
	             ],
	             [
	                 [472, 472, 128, 128, 345, 345], [472, 472, 826, 826, 635, 635], [472, 472, 826, 826, 813], [472, 472, 826, 826, 808], [472, 472, 685, 685], [472, 472, 595, 595], [472, 472, 347, 347], [472, 472, 270, 270], [472, 472, 128, 128, 100], [472, 472, 128, 128, 100], [472, 472, 128, 128, 100], [472, 472, 128, 128, 100], [], [472, 472, 490], [472, 472, 490], [472, 472, 128, 128, 245, 245]
	             ],
	             [
	                 [475, 475, 125, 125, 345, 345], [475, 475, 823, 823, 635, 635], [475, 475, 823, 823, 813], [475, 475, 823, 823, 808], [475, 475, 685, 685], [475, 475, 595, 595], [475, 475, 347, 347], [475, 475, 270, 270], [475, 475, 125, 125, 100], [475, 475, 125, 125, 100], [475, 475, 125, 125, 100], [475, 475, 125, 125, 100], [475, 475, 420, 420, 475, 474, 490], [], [475, 475, 490], [475, 475, 125, 125, 245, 245]
	             ],
	             [
	                 [454, 454, 146, 146, 345, 345], [454, 454, 844, 844, 635, 635], [454, 454, 844, 844, 813], [454, 454, 844, 844, 808], [454, 454, 685, 685], [454, 454, 595, 595], [454, 454, 347, 347], [454, 454, 270, 270], [454, 454, 146, 146, 100], [454, 454, 146, 146, 100], [454, 454, 146, 146, 100], [454, 454, 146, 146, 100], [454, 454, 435, 435, 454, 454, 490], [454, 454, 435, 435, 454, 454, 490], [], [454, 454, 146, 146, 245, 245]
	             ]
	         ];
	         var dataY = [
	             [
	                 [620, 620, 635], [620, 620, 565, 565, 550], [620, 620, 125, 125, 345, 345], [620, 620, 125, 125, 170, 170], [620, 620, 125, 125, 140], [620, 620, 125, 125, 140], [620, 620, 70, 70, 45], [620, 620, 70, 70, 45], [620, 620, 70, 70, 175, 175], [620, 620, 70, 70, 250, 250], [620, 620, 70, 70, 325, 325], [620, 620, 70, 70, 415, 415], [620, 620, 460, 460], [620, 620, 340, 340], [620, 620, 240, 240], []
	             ],
	             [
	                 [], [617, 617, 568, 568, 550], [617, 617, 122, 122, 345,  345], [617, 617, 122, 122, 170, 170], [617, 617, 122, 122, 140], [617, 617, 122, 122, 140], [617, 617, 73, 73, 45], [617, 617, 73, 73, 45], [617, 617, 73, 73, 175, 175], [617, 617, 73, 73, 250, 250], [617, 617, 73, 73, 325, 325], [617, 617, 73, 73, 415, 415], [617, 617, 460, 460], [617, 617, 340, 340], [617, 617, 240, 240], [617, 617, 567, 567, 617, 617, 635]
	             ],
	             [
	                 [571, 571, 614, 614, 635], [], [571, 571, 119, 119, 345,  345], [571, 571, 119, 119, 170, 170], [571, 571, 119, 119, 140], [571, 571, 119, 119, 140], [571, 571, 77, 77, 45], [571, 571, 77, 77, 45], [571, 571, 77, 77, 175, 175], [571, 571, 77, 77, 250, 250], [571, 571, 77, 77, 325, 325], [571, 571, 77, 77, 415, 415], [571, 571, 460, 460], [571, 571, 340, 340], [571, 571, 240, 240], [571, 571, 614, 614, 635]
	             ],
	             [
	                 [360, 574, 574, 611, 611, 635], [360, 574, 574, 550], [], [360, 611, 611, 80, 80, 170, 170], [360, 574, 574, 116, 116, 140], [360, 574, 574, 116, 116, 140], [360, 574, 574, 80, 80, 45], [360, 574, 574, 80, 80, 45], [360, 574, 574, 80, 80, 175, 175], [360, 574, 574, 80, 80, 250, 250], [360, 574, 574, 80, 80, 325, 325], [360, 574, 574, 80, 80, 415, 415], [360, 574, 574, 460, 460], [360, 574, 574, 340, 340], [360, 574, 574, 240, 240], [360, 574, 574, 611, 611, 635]
	             ],
	             [
	                 [180, 577, 577, 608, 608, 635], [180, 577, 577, 550], [180, 345,  345], [], [180, 577, 577, 113, 113, 140], [180, 577, 577, 113, 113, 140], [180, 577, 577, 83, 83, 45], [180, 577, 577, 83, 83, 45], [180, 577, 577, 83, 83, 175, 175], [180, 577, 577, 83, 83, 250, 250], [180, 577, 577, 83, 83, 325, 325], [180, 577, 577, 83, 83, 415, 415], [180, 577, 577, 460, 460], [180, 577, 577, 340, 340], [180, 577, 577, 240, 240], [180, 577, 577, 608, 608, 635]
	             ],
	             [
	                 [110, 110, 86, 86, 605, 605, 635], [110, 110, 580, 580, 550], [110, 110, 345, 345], [110, 110, 170, 170], [], [110, 110, 86, 86, 110, 110, 140], [110, 110, 86, 86, 45], [110, 110, 86, 86, 45], [110, 110, 86, 86, 175, 175], [110, 110, 86, 86, 250, 250], [110, 110, 86, 86, 325, 325], [110, 110, 86, 86, 415, 415], [110, 110, 580, 580, 460, 460], [110, 110, 580, 580, 340, 340], [110, 110, 580, 580, 240, 240], [110, 110, 86, 86, 605, 605, 635]
	             ],
	             [
	                 [107, 107, 89, 89, 602, 602, 635], [107, 107, 583, 583, 550], [107, 107, 345, 345], [107, 107, 170, 170], [107, 107, 140], [], [107, 107, 89, 89, 45], [107, 107, 89, 89, 45], [107, 107, 89, 89, 175, 175], [107, 107, 89, 89, 250, 250], [107, 107, 89, 89, 325, 325], [107, 107, 89, 89, 415, 415], [107, 107, 583, 583, 460, 460], [107, 107, 583, 583, 340, 340], [107, 107, 583, 583, 240, 240], [107, 107, 89, 89, 602, 602, 635]
	             ],
	             [
	                 [92, 92, 599, 599, 635], [92, 92, 104, 104, 586, 586, 550], [92, 92, 104, 104, 345, 345], [92, 92, 104, 104, 170, 170], [92, 92, 104, 104, 140], [92, 92, 104, 104, 140], [], [92, 92, 45], [92, 92, 175, 175], [92, 92, 250, 250], [92, 92, 325, 325], [92, 92, 415, 415], [92, 92, 599, 599, 460, 460], [92, 92, 599, 599, 340, 340], [92, 92, 599, 599, 240, 240], [92, 92, 599, 599, 635]
	             ],
	             [
	                 [89, 89, 602, 602, 635], [89, 89, 107, 107, 583, 583, 550], [89, 89, 107, 107, 345, 345], [89, 89, 107, 107, 170, 170], [89, 89, 107, 107, 140], [89, 89, 107, 107, 140], [89, 89, 107, 107, 89, 89, 45], [], [89, 89, 175, 175], [89, 89, 250, 250], [89, 89, 325, 325], [89, 89, 415, 415], [89, 89, 602, 602, 460, 460], [89, 89, 602, 602, 340, 340], [89, 89, 602, 602, 240, 240], [89, 89, 602, 602, 635]
	             ],
	             [
	                 [190, 605, 605, 635], [190, 605, 605, 580, 580, 550], [190, 605, 605, 86, 86, 345, 345], [190, 605, 605, 86, 86, 170, 170], [190, 605, 605, 110, 110, 140], [190, 605, 605, 110, 110, 140], [190, 605, 605, 86, 86, 45], [190, 605, 605, 86, 86, 45], [], [190, 250, 250], [190, 325, 325], [190, 415, 415], [190, 605, 605, 460, 460], [190, 605, 605, 340, 340], [190, 605, 605, 240, 240], [190, 605, 605, 635]
	             ],
	             [
	                 [265, 608, 608, 635], [265, 608, 608, 577, 577, 550], [265, 608, 608, 83, 83, 345, 345], [265, 608, 608, 83, 83, 170, 170], [265, 608, 608, 113, 113, 140], [265, 608, 608, 113, 113, 140], [265, 608, 608, 83, 83, 45], [265, 608, 608, 83, 83, 45], [265, 608, 608, 83, 83, 175, 175], [], [265, 325, 325], [265, 415, 415], [265, 608, 608, 460, 460], [265, 608, 608, 340, 340], [265, 608, 608, 240, 240], [265, 608, 608, 635]
	             ],
	             [
	                 [340, 611, 611, 635], [340, 611, 611, 574, 574, 550], [340, 611, 611, 80, 80, 345, 345], [340, 611, 611, 80, 80, 170, 170], [340, 611, 611, 116, 116, 140], [340, 611, 611, 116, 116, 140], [340, 611, 611, 80, 80, 45], [340, 611, 611, 80, 80, 45], [340, 611, 611, 80, 80, 175, 175], [340, 611, 611, 80, 80, 250, 250], [], [340, 415, 415], [340, 611, 611, 460, 460], [340, 611, 611, 340, 340], [340, 611, 611, 240, 240], [340, 611, 611, 635]
	             ],
	             [
	                 [430, 614, 614, 635], [430, 614, 614, 571, 571, 550], [430, 614, 614, 77, 77, 345, 345], [430, 614, 614, 77, 77, 170, 170], [430, 614, 614, 119, 119, 140], [430, 614, 614, 119, 119, 140], [430, 614, 614, 77, 77, 45], [430, 614, 614, 77, 77, 45], [430, 614, 614, 77, 77, 175, 175], [430, 614, 614, 77, 77, 250, 250], [430, 614, 614, 77, 77, 325, 325], [], [430, 614, 614, 460, 460], [430, 614, 614, 340, 340], [430, 614, 614, 240, 240], [430, 614, 614, 635]
	             ],
	             [
	                 [445, 74, 74, 617, 617, 635], [445, 122, 122, 568, 568, 550], [445, 122, 122, 345, 345], [445, 122, 122, 170, 170], [445, 122, 122, 140], [445, 122, 122, 140], [445, 74, 74, 45], [445, 74, 74, 45], [445, 74, 74, 175, 175], [445, 74, 74, 250, 250], [445, 74, 74, 325, 325], [445, 74, 74, 415, 415], [], [445, 340, 340], [445, 240, 240], [445, 74, 74, 617, 617, 635]
	             ],
	             [
	                 [325, 70, 70, 620, 620, 635], [325, 125, 125, 565, 565, 550], [325, 125, 125, 345, 345], [325, 125, 125, 170, 170], [325, 125, 125, 140], [325, 125, 125, 140], [325, 70, 70, 45], [325, 70, 70, 45], [325, 70, 70, 175, 175], [325, 70, 70, 250, 250], [325, 70, 70, 325, 325], [325, 70, 70, 415, 415], [325, 70, 70, 620, 620, 460, 460], [], [325, 240, 240], [325, 70, 70, 620, 620, 635]
	             ],
	             [
	                 [225, 92, 92, 599, 599, 635], [225, 104, 104, 586, 586, 550], [225, 104, 104, 345, 345], [225, 104, 104, 170, 170], [225, 104, 104, 140], [225, 104, 104, 140], [225, 92, 92, 45], [225, 92, 92, 45], [225, 92, 92, 175, 175], [225, 92, 92, 250, 250], [225, 92, 92, 325, 325], [225, 92, 92, 415, 415], [225, 92, 92, 599, 599, 460, 460], [225, 92, 92, 599, 599, 340, 340], [], [225, 92, 92, 599, 599, 635]
	             ]
	         ]
	             //[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]
	             //    起点坐标
	         var originX = [255, 365, 620, 813, 808, 700, 610, 332, 255, 100, 100, 100, 100, 490, 490, 490, 255];     var originY = [635, 635, 550, 360, 180, 140, 140, 45, 45, 190, 265, 340, 430, 445, 325, 225, 635];


       var distance = [
          [0.43, 3.64, 6, 5.26, 4.09, 3.68, 3.61, 3.93, 4.85, 5.19, 5.52, 5.92, 1.49, 2.04, 2.5, 0],
          [0, 3.21, 5.57, 4.83, 3.66, 3.25, 3.08, 3.4, 4.42, 4.76, 5.09, 5.49, 1.03, 1.51, 2.07, 2.47],
           [2.99, 0, 5.66, 4.92, 3.75, 3.34, 3.42, 3.74, 4.66, 4, 5.33, 5.73, 1.3, 1.85, 2.31, 2.56],
           [4.78, 1.79, 0, 4.16, 5.69, 5.28, 5.06, 5.38, 6.3, 6.64, 6.97, 7.37, 3.09, 3.64, 4.1, 4.35],
           [5.52, 2.53, 0.74, 0, 6.43, 6.02, 5.8, 6.12, 7.04, 7.38, 7.71, 8.11, 3.83, 4.38, 4.84, 5.09],
           [6.79, 3.7, 1.91, 1.17, 0, 3.49, 3.07, 3.39, 4.21, 4.55, 4.88, 5.28, 4.85, 5.4, 5.86, 6.36],
           [7.2, 4.11, 2.32, 1.58, 0.41, 0, 3.48, 3.8, 4.62, 4.96, 5.29, 5.69, 5.26, 5.81, 6.27, 6.77],
           [4.02, 6.93, 5.14, 4.4, 3.23, 2.82, 0, 0.32, 1.24, 1.58, 1.91, 2.31, 4.08, 4.63, 5.09, 3.59],
           [3.7, 6.61, 4.82, 4.08, 3.91, 2.3, 2.58, 0, 0.92, 1.26, 1.59, 1.99, 3.76, 4.31, 4.77, 3.27],
           [2.78, 5.99, 8.65, 7.91, 6.29, 5.88, 5.96, 6.28, 0, 0.34, 0.67, 1.07, 3.84, 4.39, 4.85, 2.35],
           [2.44, 5.65, 8.31, 7.57, 5.95, 5.54, 5.62, 5.94, 4.56, 0, 0.33, 0.73, 3.5, 4.05, 4.51, 2.01],
           [2.11, 5.32, 7.99, 7.25, 5.62, 5.22, 5.3, 5.62, 4.24, 4.57, 0, 0.4, 3.17, 3.72, 4.18, 1.68],
           [1.71, 4.92, 7.59, 6.85, 5.22, 4.82, 4.9, 5.22, 3.84, 4.17, 4.5, 0, 2.77, 3.32, 3.78, 1.28],
           [5.82, 6.3, 4.51, 3.77, 2.6, 2.19, 2.12, 2.44, 3.01, 3.35, 3.68, 4.08, 0, 0.55, 1.11, 5.39],
           [5.27, 5.75, 3.96, 3.22, 2.05, 1.64, 1.48, 1.89, 2.44, 2.8, 3.13, 3.43, 2.35, 0, 0.46, 4.81],
           [4.81, 5.29, 3.5, 2.76, 1.59, 1.18, 1.02, 1.23, 1.98, 2.34, 2.67, 2.97, 1.79, 2.34, 0, 4.35],
      ]

       //    正确路线
       var correct_line = [0, 12, 13, 14, 5, 4, 3, 19, 20, 2, 18, 17, 16, 1, 6, 7, 8, 9, 10, 11, 15];
       var mark = [3, 10, 2, 0, 2, 1, 2, 1, 0, 1, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0];
       var scores = [26];
    var toggle1 = true;
      var toggle2 = true;

       function statistical_score(n, m, o) {
           if (m.length == 1) {
            if (n == 0) {
                scores.push(o);
            } else {
                scores.push(o - 3);
            }
        } else {
            var indexs = correct_line.indexOf(m[m.length - 2]) + 1;
            if (n == correct_line[indexs]) {
                scores.push(o);
            } else {
                if (n == 16 || n == 17 || n == 18 || n == 1) {
                    if (m[m.length - 2] == 2) {
                        scores.push(o - 2);
                    } else {
                        if (toggle1) {
                            scores.push(o - 1);
                            toggle1 = !toggle1;
                        } else {
                            scores.push(o);
                        }
                    }
                } else if (n == 8 || n == 9 || n == 10 || n == 11) {
                    if (m[m.length - 2] == 7) {
                        //这是漏了8的扣分
                        scores.push(o - 1);
                    } else {
                        if (toggle2) {
                            scores.push(o - 1);
                            toggle2 = !toggle2;
                        } else {
                            scores.push(o);
                        }
                    }
                } else {
                    if (o - mark[indexs] <= 0) {
                        scores.push(0);
                    } else {
                        scores.push(o - mark[indexs]);
                    }
                }
            }

        }
       }

       $(".cancel").on('click', function () {
           ctx.clearRect(0, 0, 1000, 680);
        ctx.beginPath();
        ctx.font = "14px Arial";
        ctx.fillStyle = "#cdb73c";
        ctx.fillText("20层，带电梯写字楼", 635, 525);
        ctx.fillText("5层，无电梯办公楼", 660, 290);
        ctx.closePath();
        if (origin.length > 1) {
            var one = origin[origin.length - 1];
            if (one == 2) {
                $(".point_list>li").eq(points[points.length - 1]).children().removeClass("selects");
            } else if (one == 4) {
                $(".point_list>li").eq(points[points.length - 1]).children().removeClass("selects");
            }else{
                $(".point_list>li").eq(points[points.length - 1]).removeClass("select");
            }
            origin.pop();
            arrayX.pop();
            arrayY.pop();
            count.pop();
            points.pop();
            long.pop();
            scores.pop();
            for (var i = 0; i < origin.length - 1; i++) {
                clearLine(arrayX[i], arrayY[i], count[i]);
            }
        }
       })

       var long = [];
       $(".show").on('click', function () {
           
          var dis = 0;
        for (var k = 0; k < long.length; k++) {
            dis += long[k];
        }

        var line = [];
        for (var i = 0; i < points.length; i++) {
            line.push(correct_line.indexOf(points[i]));
        }
//         console.log(line);
        var lines = [];
        //处理路线，漏走为0
        for (var n = 0; n < 21; n++) {
            if (n == line.indexOf(n)) {
                lines[n] = line[n] + 1;
            } else if (line.indexOf(n) == -1) {
                lines[n] = 0;
            } else {
                lines[n] = n + 1;
            }
        }
        var final = scores[scores.length - 1];
        //关键点
        var dot = [1, 2, 4, 5, 6, 7, 9, 10, 11, 14, 15, 16, 17, 21]
        for (var m = 0; m < lines.length; m++) {
            if (lines[m] == 0 && dot.indexOf(m + 1) != -1) {
                final = (final > 0) ? final - 1 : final;
            }
            if (lines[m] == 0 && line.length == 20 && m == 19) {
                final = (final > 0) ? final - mark[m + 1] : final;
            } else if (lines[m] == 0 && line.length == 17 && m == 16) {
                final = (final > 0) ? final - 1 : final;
            } else if (lines[m] == 0 && lines[m + 1] == 0) {
                if (m == 18) {
                    final = (final > 0) ? final - 1 : final;
                } else {
                    final = (final > 0) ? final - mark[m + 1] : final;
                }
            }
        } 
        $("#score").val(final);
        $("#joinPoints").val(points.join());
        $("#dis").val(dis.toFixed(2));
        
        var data = window.location.href.split("?")[1];
        var point = $("#joinPoints").val().split(",");
        $("#long").html($("#dis").val());
        var obj = ["青年路35号", "青年路35号创业大厦5楼506室", "黄河路81号", "黄河路55号大美制衣办公楼209室", "中华路32号", "中华路56号", "中华路85号", "中华路101号", "长江路45号", "长江路53号", "长江路61号", "长江路69号", "新华路86号", "新华路72号", "新华路54号", "长江快递网店", "青年路35号创业大厦11楼1110室", "青年路35号创业大厦15楼1511室", "青年路35号创业大厦17楼1703室", "黄河路55号大美制衣办公楼318室", "黄河路55号大美制衣办公楼405室"]

        for (var i = 0; i < point.length; i++) {
            $(".point").eq(i).html(obj[point[i]]);
        }

        var date = new Date();
        var time = date.toLocaleDateString();
        $("#time").html(time + "&nbsp;" + date.toLocaleTimeString().slice(0, -3));
        $("#resultAlert").modal("toggle");
       });
       var origin = [0];
       var points = [];
       var index;
        $(".point_list>li").on('click', function () {
        index = origin[origin.length - 1];
        var num = $(this).index(".point_list>li");
        var point = num;
        if (num == 16 || num == 17 || num == 18) {
            num = 1;
        } else if (num == 19 || num == 20) {
            num = 3;
        }
        if (index != 16) {
            if (points.indexOf(point) != -1) {
            	$("#resultSpan").html("您已选择过该配送点");
                $("#resultModal").modal("toggle");
                return false;
            } else {
               if (num == 15 && points.length == 0) {

                } else {
                    points.push(point);
                    statistical_score(point, points, scores[scores.length - 1]);
                    if (origin.indexOf(num + 1) == -1) {
                        if (index == 2 || index == 4) {
                            if (index == 2) {
                                if (num == 1 || num == 3) {
//                                    $(this).children("a").attr("style", "color:#c8421a");
                                    $(this).children("a").addClass("selects");
                                } else {
                                    $(this).addClass("select");

                                }
                                long.push(distance[index][num]);
                                creatLine(dataX[index][num], dataY[index][num], index);
                                origin.push(num + 1);
                            } else if (index == 4) {
                                if (num == 1 || num == 3) {
//                                    $(this).children("a").attr("style", "color:#c8421a");
                                    $(this).children("a").addClass("selects");
                                } else {
                                    $(this).addClass("select");

                                }
                                long.push(distance[index][num]);
                                creatLine(dataX[index][num], dataY[index][num], index);
                                origin.push(num + 1);
                            }
                        } else {
                            if (num == 1 || num == 3) {
//                                $(this).children("a").attr("style", "color:#c8421a");
                                $(this).children("a").addClass("selects");
                            } else {
                                $(this).addClass("select");
                            }
                            long.push(distance[index][num]);
                            creatLine(dataX[index][num], dataY[index][num], index);
                            origin.push(num + 1);
                        }
                    } else {
                        creatLine(dataX[index][num], dataY[index][num], index);
                        origin.push(num + 1);
//                        $(this).children("a").attr("style", "color:#c8421a");
                        $(this).children("a").addClass("selects");
                    }
                }

            }
        }
    })
       var c = document.getElementById("line");
       var ctx = c.getContext("2d");
       var arrayX = [];
       var arrayY = [];
       var count = [];
       ctx.beginPath();
       ctx.font = "14px Arial";
       ctx.fillStyle = "#cdb73c";
       ctx.fillText("20层，带电梯写字楼", 606, 525);
       ctx.fillText("5层，无电梯办公楼", 660, 290);
       ctx.closePath();

       function creatLine(lineX, lineY, m) {
           ctx.beginPath();
           ctx.strokeStyle = "#f00";
           ctx.lineWidth = 2.5;
           arrayX.push(lineX);
           arrayY.push(lineY);
           count.push(m);
           ctx.moveTo(originX[m], originY[m]);
           for (var i = 0; i < lineX.length; i++) {
               ctx.lineTo(lineX[i], lineY[i]);
           }
           ctx.stroke();
           ctx.closePath();
       }
       
       //路线保存
       var dataIndex = [];
       var dataNum = [];
       var objIndex = [];
       (function(){
           var data = window.location.href.split("?")[1];
           //alert(data)
           if(data != undefined){
               var data_index = (data.split("&&")[0]).split(",");
               var data_num = (data.split("&&")[1]).split(",");
               var obj_index = (data.split("&&")[2]).split(",");

               //alert(data_index.length);

               if(data_num != ""){
                   origin = []
                   for (var i = 0; i<data_index.length; i++){
                       var _index = data_index[i]*1;
                       dataIndex.push(_index);
                       var _num = data_num[i]*1;
                       dataNum.push(_num);
                       var _i = obj_index[i]*1;
                       objIndex.push(_i);
                       points.push(_i);
                      
                       if($(".point_list > li").eq(_i).children("a").length>0){
                            $(".point_list > li").eq(_i).find('a').addClass("selects");
                       }else{
                            $(".point_list > li").eq(_i).addClass("select");
                       }

                       var data_x = dataX[_index][_num];
                       var data_y = dataY[_index][_num];

                       //if(i == data_index.length - 1){ index = data_index[i] }
                       origin.push(data_index[i]);
                       long.push(distance[_index][_num]);


                       if(i == data_index.length - 1){ 
                           origin.push(data_num[i]*1 + 1) 
                       }

                       statistical_score(_i, points, scores[scores.length - 1]);

                       creatLine( data_x , data_y , _index);
                       //console.log(_index)

                   }
               }
           }
       })();

       function clearLine(lineX, lineY, m) {
           ctx.beginPath();
           ctx.strokeStyle = "#f00";
           ctx.lineWidth = 2.5;
           ctx.moveTo(originX[m], originY[m]);
           for (var i = 0; i < lineX.length; i++) {
               ctx.lineTo(lineX[i], lineY[i]);
           }
           ctx.stroke();
           ctx.closePath();
       }
       
       function openprinl(){
           var score = data.split("&&")[2];
           if (score != 22) {
               $("#alertSpan").html("派送线路不是最优，请调整线路");
               $("#resultAlert").modal("toggle");
           } else {
	   //         	$('#modalClose').hide();//隐藏关闭按钮
	   //     		var htmls = "<div align='center' class='modal-footer'>"+ 
				// 		"<button type='button' onclick='gameOver()' class='btn btn-primary'>确定</button>"+
				// 		"</div>";
				
				// $("#resultSpan").html("任务完成！");
				// $("#nextBtn").html(htmls);
               /*$("#alertSpan").html("任务完成");
               $("#resultAlert").modal("toggle");*/
               gameOver();
           }
       }
       
})
// 游戏完成
function gameOver() {
	parent.deliveryGameOver();
}
</script>
</html>

